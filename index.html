import React, { useState, useEffect, useMemo } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getFirestore, collection, doc, onSnapshot, 
  setDoc, updateDoc, deleteDoc, query, addDoc, serverTimestamp 
} from 'firebase/firestore';
import { 
  getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken 
} from 'firebase/auth';

// Firebase Config
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'fireliq-store-unique';

const ADMIN_PASSWORD = "danil2409"; 

// --- –ù–ê–°–¢–†–û–ô–ö–ò TELEGRAM ---
const TELEGRAM_BOT_TOKEN = "8443611271:AAHQiXYvsOGI5FuoEB-Q0QTgdKleskhS1QQ"; 
const TELEGRAM_CHAT_ID = "8480602033"; 

export default function App() {
  const [user, setUser] = useState(null);
  const [view, setView] = useState('shop'); 
  const [isAdmin, setIsAdmin] = useState(false);
  const [clickCount, setClickCount] = useState(0);
  const [activeCategory, setActiveCategory] = useState("–í—Å–µ");
  const [cart, setCart] = useState({});
  const [showPassModal, setShowPassModal] = useState(false);
  const [passInput, setPassInput] = useState('');
  
  const [products, setProducts] = useState([]);
  const [categories, setCategories] = useState([]);
  const [orders, setOrders] = useState([]);
  const [loading, setLoading] = useState(true);

  const [formData, setFormData] = useState({ 
    name: '', 
    phone: '', 
    city: '', 
    street: '', 
    zip: '' 
  });

  useEffect(() => {
    const initAuth = async () => {
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, setUser);
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user) return;

    const productsRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
    const categoriesDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'categories');
    const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');

    const unsubProducts = onSnapshot(productsRef, (snapshot) => {
      const pData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setProducts(pData);
      setLoading(false);
    });

    const unsubCats = onSnapshot(categoriesDocRef, (docSnap) => {
      if (docSnap.exists()) {
        setCategories(docSnap.data().list || []);
      } else {
        const initial = ["–Ø–≥–æ–¥—ã", "–§—Ä—É–∫—Ç—ã", "–¢—Ä–æ–ø–∏–∫", "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫"];
        setDoc(categoriesDocRef, { list: initial });
      }
    });

    const unsubOrders = onSnapshot(ordersRef, (snapshot) => {
      const oData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setOrders(oData.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)));
    });

    return () => {
      unsubProducts();
      unsubCats();
      unsubOrders();
    };
  }, [user]);

  const sendTelegramNotification = async (orderData, total) => {
    if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) return;

    const itemsList = orderData.items.map(it => `üîπ ${it.flavor} (x${it.qty}) ‚Äî ${it.price * it.qty}‚Ç¨`).join('\n');
    
    const message = `
üî• *–ù–û–í–´–ô –ó–ê–ö–ê–ó FireLiQ* üî•

üë§ *–ö–ª–∏–µ–Ω—Ç:* ${orderData.customer.name}
üìû *–¢–µ–ª:* ${orderData.customer.phone}

üìç *–ê–¥—Ä–µ—Å:*
üåÜ –ì–æ—Ä–æ–¥: ${orderData.customer.city}
üè† –£–ª–∏—Ü–∞/–î–æ–º: ${orderData.customer.street}
üìÆ –ò–Ω–¥–µ–∫—Å: ${orderData.customer.zip}

üì¶ *–¢–æ–≤–∞—Ä—ã:*
${itemsList}

üí∞ *–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:* ${total}‚Ç¨
    `.trim();

    try {
      await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          chat_id: TELEGRAM_CHAT_ID,
          text: message,
          parse_mode: 'Markdown'
        })
      });
    } catch (e) {
      console.error("Telegram Error:", e);
    }
  };

  const handleLogoClick = () => {
    setClickCount(prev => {
      const next = prev + 1;
      if (next >= 10) {
        setShowPassModal(true);
        return 0;
      }
      return next;
    });
    setTimeout(() => setClickCount(0), 4000);
  };

  const checkPassword = () => {
    if (passInput === ADMIN_PASSWORD) {
      setIsAdmin(true);
      setShowPassModal(false);
      setPassInput('');
    } else {
      setPassInput('');
      setShowPassModal(false);
    }
  };

  const submitOrder = async () => {
    const { name, phone, city, street, zip } = formData;
    if (!name || !phone || !city || !street || !zip) return;
    
    const orderItems = Object.values(cart).map(item => ({
      flavor: item.flavor,
      qty: item.qty,
      price: item.price
    }));

    const totalAmount = orderItems.reduce((s, i) => s + (i.price * i.qty), 0);

    const fullOrderData = {
      customer: formData,
      items: orderItems,
      total: totalAmount,
      status: 'new',
      createdAt: serverTimestamp()
    };

    try {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), fullOrderData);
      
      await sendTelegramNotification(fullOrderData, totalAmount);

      setCart({});
      setFormData({ name: '', phone: '', city: '', street: '', zip: '' });
      setView('success');
    } catch (e) {
      console.error(e);
    }
  };

  const saveProduct = async (product) => {
    if (!isAdmin) return;
    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id.toString()), product);
  };

  const deleteProduct = async (id) => {
    if (!isAdmin) return;
    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id.toString()));
  };

  const updateCategoriesList = async (newList) => {
    if (!isAdmin) return;
    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'categories'), { list: newList });
  };

  const addToCart = (p) => {
    const inCart = cart[p.id]?.qty || 0;
    if (inCart < p.stock) {
      setCart({...cart, [p.id]: { ...p, qty: inCart + 1 }});
    }
  };

  const removeFromCart = (id) => {
    const newCart = {...cart};
    if (newCart[id].qty > 1) newCart[id].qty--;
    else delete newCart[id];
    setCart(newCart);
  };

  const filteredProducts = useMemo(() => {
    if (activeCategory === "–í—Å–µ") return products;
    return products.filter(p => p.category === activeCategory);
  }, [products, activeCategory]);

  const total = Object.values(cart).reduce((s, i) => s + (i.price * i.qty), 0);

  if (loading) return (
    <div className="min-h-screen bg-[#0a0a0b] flex flex-col items-center justify-center text-orange-500 font-black">
      <span className="text-6xl mb-4 animate-pulse">üî•</span>
      <p>FIRELIQ ONLINE...</p>
    </div>
  );

  return (
    <div className="max-w-md mx-auto min-h-screen p-4 pb-32 bg-[#0a0a0b] text-zinc-100 font-sans">
      
      <header className="flex justify-between items-center py-4 sticky top-0 bg-[#0a0a0b]/95 backdrop-blur-md z-50">
        <div className="flex items-center gap-2 cursor-pointer select-none" onClick={handleLogoClick}>
          <span className="text-3xl">üî•</span>
          <span className="font-black text-2xl italic tracking-tighter uppercase">FireLiQ</span>
        </div>
        <div className="flex gap-2">
          {isAdmin && (
            <button onClick={() => setView('admin')} className={`w-10 h-10 flex items-center justify-center rounded-xl bg-zinc-900 border ${view === 'admin' ? 'border-orange-500 text-orange-500' : 'border-zinc-800'}`}>
              ‚öôÔ∏è
            </button>
          )}
          <button onClick={() => setView('cart')} className="w-10 h-10 flex items-center justify-center rounded-xl bg-zinc-900 border border-zinc-800 relative">
            üõí {total > 0 && <span className="absolute -top-1 -right-1 bg-orange-500 w-4 h-4 rounded-full text-[10px] text-black font-black flex items-center justify-center">!</span>}
          </button>
        </div>
      </header>

      {view === 'shop' && (
        <div className="animate-in fade-in duration-500">
          <div className="flex gap-2 overflow-x-auto no-scrollbar pb-6 pt-2">
            <button onClick={() => setActiveCategory("–í—Å–µ")} className={`whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-colors ${activeCategory === "–í—Å–µ" ? 'bg-orange-500 border-orange-500 text-black' : 'bg-zinc-900 border-zinc-800'}`}>–í—Å–µ</button>
            {categories.map(cat => (
              <button key={cat} onClick={() => setActiveCategory(cat)} className={`whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-colors ${activeCategory === cat ? 'bg-orange-500 border-orange-500 text-black' : 'bg-zinc-900 border-zinc-800'}`}>
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-3">
            {filteredProducts.map(p => {
              const inCart = cart[p.id]?.qty || 0;
              return (
                <div key={p.id} className="bg-[#141417] border border-zinc-800 rounded-2xl overflow-hidden flex flex-col group">
                  <div className="h-32 bg-zinc-900 relative flex items-center justify-center overflow-hidden">
                    {p.image ? (
                      <img src={p.image} className="w-full h-full object-cover" alt={p.flavor} />
                    ) : (
                      <span className="text-4xl opacity-10">üî•</span>
                    )}
                    <span className="absolute top-2 left-2 text-[7px] font-black bg-black/60 px-2 py-1 rounded text-orange-400 uppercase tracking-widest">{p.category}</span>
                  </div>
                  <div className="p-3 flex flex-col flex-1">
                    <h4 className="text-xs font-black uppercase truncate text-zinc-100">{p.flavor}</h4>
                    <div className="mt-auto flex justify-between items-end pt-2">
                      <div>
                        <div className="text-[8px] font-bold text-zinc-500 uppercase">–°–∫–ª–∞–¥: {p.stock}</div>
                        <div className="text-lg font-black text-white">{p.price}‚Ç¨</div>
                      </div>
                      <button 
                        onClick={() => addToCart(p)}
                        disabled={inCart >= p.stock || p.stock === 0}
                        className="w-9 h-9 flex items-center justify-center rounded-xl bg-orange-500 text-black text-xl font-black disabled:opacity-20 active:scale-90 transition-transform"
                      >
                        {p.stock === 0 ? '√ò' : inCart >= p.stock ? 'MAX' : '+'}
                      </button>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )}

      {view === 'cart' && (
        <div className="space-y-6 animate-in slide-in-from-right duration-300">
          <div className="flex items-center gap-4">
            <button onClick={() => setView('shop')} className="w-10 h-10 rounded-xl bg-zinc-900 text-zinc-400 flex items-center justify-center">‚Üê</button>
            <h2 className="text-2xl font-black uppercase italic">–ö–æ—Ä–∑–∏–Ω–∞</h2>
          </div>
          {Object.values(cart).length > 0 ? (
             <div className="space-y-4">
               {Object.values(cart).map(item => (
                 <div key={item.id} className="flex justify-between items-center bg-[#141417] p-4 rounded-2xl border border-zinc-800">
                    <div className="flex gap-3 items-center">
                        <div className="w-10 h-10 rounded-lg bg-zinc-800 overflow-hidden shrink-0">
                            {item.image ? <img src={item.image} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-[8px]">FIRE</div>}
                        </div>
                        <div>
                            <div className="text-[10px] text-orange-500 font-bold uppercase">{item.category}</div>
                            <div className="font-black text-sm uppercase">{item.flavor}</div>
                        </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <button onClick={() => removeFromCart(item.id)} className="w-8 h-8 rounded-lg bg-zinc-800 font-bold">-</button>
                      <span className="font-black text-orange-500 w-4 text-center">{item.qty}</span>
                      <button onClick={() => addToCart(item)} disabled={item.qty >= item.stock} className="w-8 h-8 rounded-lg bg-zinc-800 font-bold">+</button>
                    </div>
                 </div>
               ))}
               <div className="pt-6 border-t border-zinc-800">
                   <div className="flex justify-between mb-4 px-2">
                       <span className="font-bold text-zinc-500 uppercase text-xs">–ò—Ç–æ–≥–æ</span>
                       <span className="font-black text-xl text-white">{total} ‚Ç¨</span>
                   </div>
                   <button 
                    onClick={() => setView('checkout')}
                    className="w-full py-5 rounded-2xl bg-orange-500 text-black font-black text-xl uppercase italic shadow-lg shadow-orange-500/20"
                   >
                       –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                   </button>
               </div>
             </div>
          ) : <div className="text-center py-24 opacity-20 font-black uppercase italic">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>}
        </div>
      )}

      {view === 'checkout' && (
        <div className="space-y-6 animate-in slide-in-from-right duration-300">
          <div className="flex items-center gap-4">
            <button onClick={() => setView('cart')} className="w-10 h-10 rounded-xl bg-zinc-900 text-zinc-400 flex items-center justify-center">‚Üê</button>
            <h2 className="text-2xl font-black uppercase italic">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
          </div>
          <div className="bg-[#141417] p-6 rounded-3xl border border-zinc-800 space-y-4 shadow-xl">
            <div className="space-y-1">
              <label className="text-[10px] font-black text-orange-500 uppercase px-1">–ò–º—è, —Ñ–∞–º–∏–ª–∏—è</label>
              <input 
                className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none focus:border-orange-500 transition-colors text-sm" 
                placeholder="" 
                value={formData.name}
                onChange={e => setFormData({...formData, name: e.target.value})}
              />
            </div>
            
            <div className="space-y-1">
              <label className="text-[10px] font-black text-orange-500 uppercase px-1">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
              <input 
                className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none focus:border-orange-500 transition-colors text-sm" 
                placeholder="" 
                type="tel"
                value={formData.phone}
                onChange={e => setFormData({...formData, phone: e.target.value})}
              />
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-orange-500 uppercase px-1">–ì–æ—Ä–æ–¥</label>
              <input 
                className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none focus:border-orange-500 transition-colors text-sm" 
                placeholder="" 
                value={formData.city}
                onChange={e => setFormData({...formData, city: e.target.value})}
              />
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-orange-500 uppercase px-1">–£–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –¥–æ–º–∞</label>
              <input 
                className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none focus:border-orange-500 transition-colors text-sm" 
                placeholder="" 
                value={formData.street}
                onChange={e => setFormData({...formData, street: e.target.value})}
              />
            </div>

            <div className="space-y-1">
              <label className="text-[10px] font-black text-orange-500 uppercase px-1">–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å</label>
              <input 
                className="w-full bg-zinc-900 border border-zinc-800 p-4 rounded-xl outline-none focus:border-orange-500 transition-colors text-sm" 
                placeholder="" 
                value={formData.zip}
                onChange={e => setFormData({...formData, zip: e.target.value})}
              />
            </div>

            <button 
              onClick={submitOrder}
              disabled={!formData.name || !formData.phone || !formData.city || !formData.street || !formData.zip}
              className="w-full py-5 rounded-2xl bg-orange-500 text-black font-black text-xl uppercase italic disabled:opacity-30 mt-4 active:scale-95 transition-all shadow-lg shadow-orange-500/20"
            >
              –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ‚Äî {total}‚Ç¨
            </button>
          </div>
        </div>
      )}

      {view === 'success' && (
        <div className="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center p-8 text-center animate-in zoom-in duration-300">
          <div className="w-24 h-24 bg-orange-500 rounded-full flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(249,115,22,0.5)]">
            <span className="text-5xl">üî•</span>
          </div>
          <h2 className="text-4xl font-black italic uppercase tracking-tighter mb-4 text-orange-500">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</h2>
          <p className="text-zinc-400 text-sm mb-10 font-medium">–í–∞—à –∑–∞–∫–∞–∑ –ø–µ—Ä–µ–¥–∞–Ω –≤ –æ–±–ª–∞–∫–æ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
          <button onClick={() => setView('shop')} className="w-full py-5 rounded-2xl bg-zinc-900 text-white font-black text-xl uppercase italic">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
      )}

      {view === 'admin' && isAdmin && (
        <div className="space-y-8 animate-in slide-in-from-left duration-300">
          <div className="flex items-center justify-between sticky top-16 bg-[#0a0a0b]/90 py-2 z-40">
            <button onClick={() => setView('shop')} className="w-10 h-10 rounded-xl bg-zinc-900 text-zinc-400 font-bold flex items-center justify-center">‚Üê</button>
            <h2 className="text-xl font-black uppercase italic">–ê–¥–º–∏–Ω–∫–∞</h2>
          </div>

          <section className="space-y-3">
            <h3 className="text-[10px] font-black text-orange-500 uppercase px-1 tracking-widest">–ó–∞–∫–∞–∑—ã ({orders.length})</h3>
            <div className="space-y-3">
              {orders.map(o => (
                <div key={o.id} className="bg-zinc-900 border border-zinc-800 p-4 rounded-2xl space-y-2">
                  <div className="flex justify-between items-start">
                    <div>
                      <div className="font-black text-white text-sm">{o.customer?.name}</div>
                      <div className="text-[10px] text-zinc-500">{o.customer?.phone}</div>
                    </div>
                    <div className="text-orange-500 font-black">{o.total}‚Ç¨</div>
                  </div>
                  <div className="text-[10px] text-zinc-400 bg-black/30 p-3 rounded-lg leading-relaxed">
                    <span className="text-orange-500/50 font-black uppercase text-[8px] block mb-1">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                    {o.customer?.city}, {o.customer?.street} <br/>
                    –ò–Ω–¥–µ–∫—Å: {o.customer?.zip}
                  </div>
                  <div className="pt-2 border-t border-zinc-800">
                    {o.items?.map((it, idx) => (
                      <div key={idx} className="text-[10px] flex justify-between py-0.5">
                        <span className="text-zinc-300">{it.flavor} x{it.qty}</span>
                        <span className="text-zinc-500">{it.price * it.qty}‚Ç¨</span>
                      </div>
                    ))}
                  </div>
                  <button onClick={() => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', o.id))} className="w-full py-1.5 text-[8px] uppercase font-black text-red-500 border border-red-900/30 rounded-md mt-2 hover:bg-red-500/10">–£–¥–∞–ª–∏—Ç—å –∏–∑ –±–∞–∑—ã</button>
                </div>
              ))}
              {orders.length === 0 && <div className="text-center py-4 text-zinc-600 text-[10px] uppercase font-bold tracking-widest">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>}
            </div>
          </section>

          <section className="space-y-3">
            <h3 className="text-[10px] font-black text-orange-500 uppercase px-1 tracking-widest">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div className="flex flex-wrap gap-2">
              {categories.map(c => (
                <div key={c} className="bg-zinc-900 px-3 py-2 rounded-xl border border-zinc-800 flex items-center gap-2 text-xs font-bold">
                  {c} <button onClick={() => updateCategoriesList(categories.filter(x => x !== c))} className="text-red-500">‚úï</button>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input id="catIn" placeholder="" className="bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-3 flex-1 text-sm outline-none focus:border-orange-500" />
              <button onClick={() => {
                const val = document.getElementById('catIn').value;
                if(val) { updateCategoriesList([...categories, val]); document.getElementById('catIn').value = ''; }
              }} className="bg-zinc-800 px-5 rounded-xl font-bold">+</button>
            </div>
          </section>

          <section className="space-y-4 pb-10">
            <div className="flex justify-between items-center px-1">
              <h3 className="text-[10px] font-black text-orange-500 uppercase tracking-widest">–í–∏—Ç—Ä–∏–Ω–∞</h3>
              <button onClick={() => saveProduct({ id: Date.now(), flavor: "–ù–û–í–´–ô –¢–û–í–ê–†", price: 15, stock: 10, category: categories[0] || "–¢—Ä–æ–ø–∏–∫", image: "", inStock: true })} className="text-[9px] font-black text-orange-500 hover:text-orange-400 transition-colors">+ –¢–û–í–ê–†</button>
            </div>
            {products.map(p => (
              <div key={p.id} className="bg-[#141417] p-4 rounded-2xl border border-zinc-800 space-y-3">
                <div className="grid grid-cols-2 gap-2">
                  <input className="bg-zinc-900 border border-zinc-800 p-2.5 rounded-lg text-xs outline-none focus:border-orange-500" value={p.flavor} onChange={e => saveProduct({...p, flavor: e.target.value})} placeholder="" />
                  <select className="bg-zinc-900 border border-zinc-800 p-2.5 rounded-lg text-xs outline-none focus:border-orange-500" value={p.category} onChange={e => saveProduct({...p, category: e.target.value})}>
                    {categories.map(c => <option key={c} value={c}>{c}</option>)}
                  </select>
                </div>
                <input className="bg-zinc-900 border border-zinc-800 p-2.5 rounded-lg text-[10px] w-full outline-none focus:border-orange-500" value={p.image} onChange={e => saveProduct({...p, image: e.target.value})} placeholder="" />
                <div className="grid grid-cols-2 gap-2">
                  <input type="number" className="bg-zinc-900 border border-zinc-800 p-2.5 rounded-lg text-xs outline-none focus:border-orange-500" value={p.price} onChange={e => saveProduct({...p, price: Number(e.target.value)})} />
                  <input type="number" className="bg-zinc-900 border border-zinc-800 p-2.5 rounded-lg text-xs outline-none focus:border-orange-500" value={p.stock} onChange={e => saveProduct({...p, stock: Number(e.target.value)})} />
                </div>
                <button onClick={() => deleteProduct(p.id)} className="w-full py-2 bg-red-950/20 text-red-500 border border-red-900/30 rounded-xl text-[9px] font-black uppercase">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            ))}
          </section>
        </div>
      )}

      {showPassModal && (
        <div className="fixed inset-0 bg-black/95 backdrop-blur-xl z-[100] flex items-center justify-center p-6">
          <div className="bg-zinc-900 border border-zinc-800 p-8 rounded-[32px] w-full max-w-[320px] text-center space-y-6">
            <h3 className="font-black uppercase italic text-lg tracking-tighter">–î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ</h3>
            <input 
              type="password" 
              autoFocus
              className="w-full bg-black border border-zinc-800 rounded-2xl p-4 text-center outline-none focus:border-orange-500 font-black tracking-widest" 
              value={passInput}
              onChange={e => setPassInput(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && checkPassword()}
            />
            <button onClick={checkPassword} className="w-full py-4 bg-orange-500 text-black font-black rounded-2xl uppercase italic active:scale-95 transition-all">–í–æ–π—Ç–∏</button>
            <button onClick={() => setShowPassModal(false)} className="text-zinc-500 text-[10px] font-bold uppercase tracking-widest hover:text-zinc-400 transition-colors">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      )}

      {view === 'shop' && total > 0 && (
        <div className="fixed bottom-8 left-6 right-6 z-40 animate-in slide-in-from-bottom duration-300">
          <button onClick={() => setView('cart')} className="w-full p-5 bg-orange-500 rounded-2xl flex justify-between items-center text-black shadow-2xl shadow-orange-500/40 active:scale-[0.98] transition-all">
            <span className="font-black italic uppercase text-sm tracking-tighter">–ö –∑–∞–∫–∞–∑—É</span>
            <span className="text-xl font-black">{total} ‚Ç¨</span>
          </button>
        </div>
      )}

    </div>
  );
}



